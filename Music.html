<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">
  <meta name="theme-color" content="#02121b">
  <link rel="icon" sizes="192x192" href="https://1nrp.github.io/1/Images/N-Logo1.png">
  <title> Music </title>
<style>
body {
  background-color: #0d2136;
  color: #fff;
  scrollbar-width: none;
  font-family: Arial, monospace, sans-serif;
}
#player {
  border: 4px solid #6aa9;
  border-radius: 50px;
  background-color: #08f;
  width: 94vw;
  max-height: 10vh;
  margin: -4px 0px 2px 0px;
}
#header {
  align-items:center;
  display:flex;
  flex-direction:row;
  border:2px dashed #358;
  width:99%;
  height:5vh;
}
#txtBox {
  border:none;
  color:#863;
  resize: none;
  height: 80%;
  scrollbar-width: none;
  background-color:#021133;
  width:80%;
  outline: 0;
  font-weight: 700;
  font-size: 20px;
}
#loadBtn:hover {
  background-color: #223344;
}
#hamburgerMenu {
  position: absolute;
  bottom: 10px;
  z-index: 100;
  right: 10px;
  font-size: 14px;
  font-weight: 1000;
  transition: transform 0.4s ease;
  color: #e2df12;
  border: 2px solid #7c7676;
  border-radius: 50px;
  background-color: #470505b4;
}
#loadBtn {
  border:none;
  width:20%;
  height: 100%;
  font-weight: 900;
  background-color:#345;
  font-size:20px;
  color:#369
}
::placeholder {
  font-size: 20px;
  font-weight: 700;
  color: #a4a4a4;
}
.channelName {
  color: #12777a;
  font-weight: 700;
  font-size: 14px; 
  font-family: monospace, sans-serif; 
  text-align: left
}
.songName {
  color: #915959;
  font-weight: 700;
  font-size: 16px; 
  font-family: Arial, sans-serif; 
  text-align: left; 
}
#viewBox {
  width: 99%;
  height: 80vh;
  border-radius: 4px;
  border: 2px solid #333;
  overflow-y: scroll;
  scrollbar-width: none;
  background: linear-gradient(140deg, #02364b, #793c04);
  margin: 4px 0px 2px 0px;
  display: flex;
  flex-wrap: wrap;
  overflow-x: auto;
  flex-direction: row;
}
.selectOptions {
  font-weight: 600;
  color: #b4b4b4;
  border: 2px dotted #555;
  border-radius: 4px;
  background-color: #02121b;
  width: 90px;
  padding: 2px;
}
.toolBar {
  position: fixed;
  bottom: 4%;
  left: 4%;
  padding: 4px;
  background-color: #031b5c63;
  border: solid 2px #04348f;
  margin: 2px;
  border-radius: 10px;
  z-index: 20;
  font-family: Arial, Courier, monospace, sans-serif;
  font-size: 12px;
  font-weight: 600;
}
.blurElements {
  filter: blur(10px);
}
.imgBox {
  max-width: 100%;
  min-width: 45%;
  display: flex;
  flex-direction: column;
  margin: 2px;
}
.image {
  height: auto;
  border-radius: 4px;
}
.loader {
  position: fixed;
  top: 40%;
  width: 40%;
  left: calc( (100% - 40%) / 2 );
  display: inline-grid;
  z-index: 10;
  aspect-ratio: 1;
  clip-path: polygon(100% 50%,85.36% 85.36%,50% 100%,14.64% 85.36%,0% 50%,14.64% 14.64%,50% 0%,85.36% 14.64%);
  /* clip-path: square; */
  /* clip-path: polygon(100% 50%, 50% 100%, 0% 50%, 50% 0%); */
  background: #ce0404;
  animation: Loading 2s infinite linear;
}
.loader:before,
.loader:after {
  content:"";
  grid-area: 1/1;
  background: #08ebeb;
  clip-path: inherit;
  margin: 10%;
  animation: inherit;
  animation-duration: 8s;
}
.loader:after {
  background: #043772;
  margin: 25%;
  animation-duration: 12s;
}

@keyframes Loading {
  to { rotate: 1turn } 
}
</style>
</head>
<body>
  <div id="loading"></div>
  <!-- loop="loop" -->
  <audio id="player" controls tabindex="0" src="" width="100%" autoplay ></audio> 

  <div id="header">
    <textarea id='txtBox' placeholder="Example: Kaabil" value=""></textarea>
    <button id='loadBtn' onclick="viewImages()">LOAD</button>
  </div>

  <button id="hamburgerMenu" onclick="toggleToolbar(); style.transform = (style.transform === 'rotate(180deg)' ? 'rotate(0deg)' : 'rotate(180deg)');">â˜°</button>
  <div id="viewBox" ondblclick=" document.getElementById('player').src = ''; ThirdPartyAPI = ThirdPartyAPI === true ? false : true" > </div>
  
  <div id="toolBar" class="toolBar">
    <b style="color: #fff222"> Response Type : </b>
    <select id="responseType" class="selectOptions">
      <option value="video">Video</option>
      <option value="channel">Channel</option>
      <option value="playlist">Playlist</option>
    </select>
    <br></br>
    <b style="color: #fff222"> 3rd Party API : </b>
    <input type="checkbox" id="thirdPartyApi" style="transform: translateY(10%)" ></input>
    <br></br>
    <b style="color: #fff222"> Auto-Play Next : </b>
    <input type="checkbox" id="autoPlay" checked style="transform: translateY(10%)" ></input>
    <br></br>
    <input type="radio" id="option1" name="choice" value="video" checked>
    <label for="option1"> Video </label>
    <input type="radio" id="option2" name="choice" value="playlist">
    <label for="option2"> Playlist </label>
  </div>

<script>
// https://api.vreden.my.id/api/v1/download/youtube/audio?url=https://www.youtube.com/watch?v=CPWEyB1Jl9g&quality=128
// https://www.youtube.com/watch?v=CPWEyB1Jl9g

// Get Element By ID Shortcut (Jquery Style).
const ID = (elementId) => document.getElementById(elementId);

let currentJson = {};

// Fetch JSON and view thumbnails.
async function viewImages(playlist = null) {
  const type = ID('responseType').value;
  let songName = ID('txtBox').value.trim() || 'Kaabil Song';
  songName = type === 'playlist' ? 'new hindi songs' : songName;
  Loading('Show');
  let url = type === 'playlist' ? 'https://1nrp.val.run/songList' + '?query=' + songName + '&type=playlist' : 'https://1nrp.val.run/songList' + '?query=' + songName + '&type=video';
  url = playlist ? 'https://1nrp.val.run/songList?type=getPlaylistItems' + '&id=' + playlist : url;
  const req = await fetch(url);
  const media = await req.json();
  Loading('Hide');
  currentJson = media;
  ID('viewBox').innerHTML = '';
  if (playlist) ID('viewBox').style.background = "linear-gradient(270deg, #792504, #031a44)";
  let count = 1;
  for ( const song of media ) {
      const { videoId, playlistId, title, channelTitle, thumbnail } = song;
      const box = document.createElement('div');
      box.className = 'imgBox';
      const imageHtmlLine = playlistId
        ? ` <img src="${thumbnail}" onclick="viewImages('${playlistId}')" alt="Thumbnail Image" class="image"> `
        : ` <img src="${thumbnail}" onclick="PlayAudio('${videoId}')" alt="Thumbnail Image" class="image"> `;
        box.innerHTML = ` 
        ${imageHtmlLine}
        <span class="songName">${count} - ${title}</span>
        <span class="channelName">${channelTitle}</span>
      `;
      ID('viewBox').appendChild(box);
      count++;
  }
}

ID('player').addEventListener('ended', () => {
  const autoPlay = ID('autoPlay').checked;
  const nextSong = currentJson.shift();
  if (!autoPlay || !nextSong) return;
  PlayAudio(nextSong.videoId);
});

async function viewPlaylists() {
  let playListName = ID('txtBox').value;
  playListName = playListName ? playListName : 'new hindi songs';
  Loading('Show');
  const req = await fetch('https://1nrp.val.run/songList' + '?query=' + playListName + '&type=playlist');
  const media = await req.json();
  Loading('Hide');
  currentJson = media;
  ID('viewBox').innerHTML = '';
  let count = 1;
  for ( const song of media ) {
      const { playlistId, title, channelTitle, thumbnail } = song;
      const box = document.createElement('div');
      box.className = 'imgBox';
      box.innerHTML = ` 
        <img src="${thumbnail}" onclick="GetPlayListItems('${playlistId}, playlist')" alt="Thumbnail Image" class="image">
        <span class="songName">${count} - ${title}</span>
        <span class="channelName">${channelTitle}</span>
      `;
      ID('viewBox').appendChild(box);
      count++;
  }
}

async function GetPlayListItems(playlistId) {
  Loading('Show');
  const req = await fetch('https://1nrp.val.run/playListSongs' + '?id=' + playlistId);
  const media = await req.json();
  Loading('Hide');
  currentJson = media;
  ID('viewBox').innerHTML = '';
  let count = 1;
  for ( const song of media ) {
      const { videoId, title, channelTitle, thumbnail } = song;
      const box = document.createElement('div');
      box.className = 'imgBox';
      box.innerHTML = ` 
        <img src="${thumbnail}" onclick="PlayAudio('${videoId}')" alt="Thumbnail Image" class="image">
        <span class="songName">${count} - ${title}</span>
        <span class="channelName">${channelTitle}</span>
      `;
      ID('viewBox').appendChild(box);
      count++;
  }
}

async function PlayAudio(videoId) {
    Loading('Show');
    const ThirdPartyAPI = ID('thirdPartyApi').checked;
    const url = ThirdPartyAPI ? 'https://api.vreden.my.id/api/v1/download/youtube/audio?url=https://www.youtube.com/watch?v=' + videoId + '&quality=128' : 'https://1nrp.val.run/songUrl' + '?vid=' + videoId;
    const res = await fetch(url);
    const data = await res.json();
    Loading('Hide');
    const link = data.link ?? data.result.download.url;
    const player = ID('player');
    player.src = link;
    const { name = 'Default' } = currentJson.find(song => song.videoId === videoId);
    ID('txtBox').value = '';
    ID('txtBox').placeholder = name;
}

function Loading(status) {
  const blurElems = ['player', 'header', 'viewBox'];
  if (status === 'Show') {
    ID('loading').className = 'loader';
    blurElems.forEach((element) => ID(element).className = 'blurElements');
  } else {
    ID('loading').className = '';
    for (const element of blurElems) { ID(element).className = '' }
  }
}

function toggleToolbar() {
    const toolbar = ID('toolBar');
    const status = toolbar.style.display;
    toolbar.style.display = status === 'none' ? 'block' : 'none';
}

</script>
</body>
</html>
